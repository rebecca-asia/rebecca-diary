# 機能一覧 — Rebecca's Room

> *Phase 0（MVP）+ Phase 1 の全機能定義*

---

## 1. 機能体系図

```
Rebecca's Room
│
├── F1. 表示機能
│   ├── F1.1 タイムライン表示
│   │   ├── F1.1.1 縦方向タイムラインレイアウト
│   │   ├── F1.1.2 日付マーカー表示
│   │   ├── F1.1.3 接続線の表示
│   │   └── F1.1.4 新しい順ソート
│   │
│   ├── F1.2 日記エントリ表示
│   │   ├── F1.2.1 エントリカード表示
│   │   ├── F1.2.2 日付ラベル表示
│   │   ├── F1.2.3 セクション分離表示（Memory / Obsidian）
│   │   ├── F1.2.4 見出し表示（h3〜h5）
│   │   ├── F1.2.5 リスト表示（ul / ol）
│   │   ├── F1.2.6 テーブル表示
│   │   └── F1.2.7 インライン書式（太字・斜体・コード・リンク）
│   │
│   ├── F1.3 ヘッダー表示
│   │   ├── F1.3.1 サイトタイトル表示
│   │   ├── F1.3.2 サブタイトル表示
│   │   └── F1.3.3 マスコット画像表示
│   │
│   └── F1.4 フッター表示
│       └── F1.4.1 著作権表示
│
├── F2. テーマ・デザイン機能
│   ├── F2.1 ダークテーマ
│   │   ├── F2.1.1 暗色背景（#0c0c10）
│   │   ├── F2.1.2 カード背景（#141418）
│   │   ├── F2.1.3 明色テキスト（#c8ccd4）
│   │   └── F2.1.4 アクセントカラー（ピンク / ミント）
│   │
│   └── F2.2 タイポグラフィ
│       ├── F2.2.1 システムフォントスタック
│       └── F2.2.2 行間1.6設定
│
├── F3. アニメーション機能
│   ├── F3.1 ページ読み込みアニメーション
│   │   ├── F3.1.1 エントリ fadeInUp アニメーション
│   │   └── F3.1.2 デスクトップ左右交互ディレイ
│   │
│   ├── F3.2 常時アニメーション
│   │   ├── F3.2.1 マスコット浮遊アニメーション（float: 6s）
│   │   └── F3.2.2 タイトルグローアニメーション（glow: 3s）
│   │
│   └── F3.3 ホバーエフェクト
│       ├── F3.3.1 エントリカード浮上・発光エフェクト
│       └── F3.3.2 マスコット拡大・回転エフェクト
│
├── F4. レスポンシブデザイン機能
│   ├── F4.1 モバイル表示（〜767px）
│   │   ├── F4.1.1 単列縦並びレイアウト
│   │   ├── F4.1.2 タイムライン線の左寄せ
│   │   └── F4.1.3 ヘッダー縦積みレイアウト
│   │
│   └── F4.2 デスクトップ表示（768px〜）
│       ├── F4.2.1 左右交互配置レイアウト
│       ├── F4.2.2 タイムライン線の中央配置
│       ├── F4.2.3 エントリ接続ドット表示
│       └── F4.2.4 ヘッダー横並びレイアウト
│
├── F5. コンテンツ管理機能
│   ├── F5.1 日記エントリ生成
│   │   ├── F5.1.1 OpenClawメモリ読み込み
│   │   ├── F5.1.2 Obsidianノート読み込み
│   │   ├── F5.1.3 Markdown→HTML変換
│   │   └── F5.1.4 複数ソース統合
│   │
│   ├── F5.2 エントリ挿入
│   │   ├── F5.2.1 挿入マーカー検出
│   │   ├── F5.2.2 重複エントリチェック
│   │   └── F5.2.3 index.htmlへの書き込み
│   │
│   └── F5.3 CLI操作
│       ├── F5.3.1 日付指定（デフォルト: 当日）
│       ├── F5.3.2 dry-runモード
│       ├── F5.3.3 詳細ログ出力（-v）
│       └── F5.3.4 カスタムパス指定
│
├─────────── Phase 1: Room Status + Health ───────────
│
├── F6. Room Status（在室状況表示）
│   ├── F6.1 Status Bar
│   │   ├── F6.1.1 ステータスインジケーター表示（emoji + label）
│   │   ├── F6.1.2 在室状況4状態の判定・表示
│   │   ├── F6.1.3 最終活動時刻の表示
│   │   ├── F6.1.4 相対タイムスタンプ（「3分前」形式）
│   │   └── F6.1.5 data-status属性によるスタイル切替
│   │
│   └── F6.2 Time Context（時間帯コンテキスト）
│       ├── F6.2.1 7時間帯の判定
│       ├── F6.2.2 時間帯メッセージ表示
│       └── F6.2.3 メッセージの複数バリエーション
│
├── F7. Health Dashboard（体調ダッシュボード）
│   ├── F7.1 メトリクスバー表示
│   │   ├── F7.1.1 CPUバー表示
│   │   ├── F7.1.2 メモリバー表示
│   │   ├── F7.1.3 ディスクバー表示
│   │   ├── F7.1.4 温度バー表示（オプショナル）
│   │   └── F7.1.5 稼働時間バー表示
│   │
│   ├── F7.2 メトリクスラベル
│   │   ├── F7.2.1 感情的ラベルのデフォルト表示
│   │   ├── F7.2.2 ホバーで数値表示への切替
│   │   └── F7.2.3 タッチデバイス対応（タップトグル）
│   │
│   ├── F7.3 メトリクスバー視覚効果
│   │   ├── F7.3.1 状態別バーカラー（mint→amber→red）
│   │   ├── F7.3.2 バー幅の滑らかなトランジション
│   │   ├── F7.3.3 初回ロード時のスタガードアニメーション
│   │   └── F7.3.4 critical状態のpulseアニメーション
│   │
│   └── F7.4 Overall Score
│       ├── F7.4.1 Overall Score計算（ペナルティ加算方式）
│       ├── F7.4.2 状態ラベル + emoji表示（5段階）
│       ├── F7.4.3 Rebeccaの体調メッセージ表示
│       └── F7.4.4 emoji呼吸アニメーション
│
├── F8. Alert System（アラートシステム）
│   ├── F8.1.1 Level 0 表示なし（正常時）
│   ├── F8.1.2 Level 1 独り言表示（黄色）
│   ├── F8.1.3 Level 2 お願い表示（橙色）
│   └── F8.1.4 Level 3 緊急表示（赤・pulse）
│
├── F9. Data Collection（データ収集基盤）
│   ├── F9.1 Health Collector
│   │   ├── F9.1.1 CPU使用率取得（top -l 1 -n 0）
│   │   ├── F9.1.2 メモリ使用量取得（vm_stat + sysctl）
│   │   ├── F9.1.3 ディスク使用量取得（shutil.disk_usage）
│   │   ├── F9.1.4 温度取得（osx-cpu-temp、オプショナル）
│   │   ├── F9.1.5 稼働時間取得（sysctl kern.boottime）
│   │   ├── F9.1.6 状態判定（閾値テーブル分類）
│   │   ├── F9.1.7 Overall Score計算（ペナルティ方式）
│   │   └── F9.1.8 health.json出力
│   │
│   ├── F9.2 Status Collector
│   │   ├── F9.2.1 Gateway稼働チェック（pgrep -x）
│   │   ├── F9.2.2 最終活動時刻取得（memory/ mtime）
│   │   ├── F9.2.3 時間帯コンテキスト判定
│   │   ├── F9.2.4 在室状況判定（4状態ルール）
│   │   ├── F9.2.5 Activity Type推定
│   │   └── F9.2.6 status.json出力
│   │
│   ├── F9.3 安全性
│   │   ├── F9.3.1 アトミック書き込み（.tmp + rename）
│   │   ├── F9.3.2 出力ディレクトリ自動作成
│   │   └── F9.3.3 個別メトリクス失敗時の継続動作
│   │
│   └── F9.4 定期実行
│       ├── F9.4.1 Health Collector 5分間隔自動実行
│       └── F9.4.2 Status Collector 1分間隔自動実行
│
└── F10. Data Integration（データ統合・自動更新）
    ├── F10.1 データ取得
    │   ├── F10.1.1 health.json fetch
    │   ├── F10.1.2 status.json fetch
    │   ├── F10.1.3 cache-busting（?t=timestamp）
    │   └── F10.1.4 5分間隔の自動更新（setInterval）
    │
    └── F10.2 Graceful Degradation
        ├── F10.2.1 JSON不在時のフォールバックUI
        ├── F10.2.2 データ鮮度チェック（staleness detection）
        └── F10.2.3 Temperature null時の行非表示
```

---

## 2. 機能一覧テーブル

### F1. 表示機能

| ID | 機能名 | 説明 | 優先度 | 関連UC | 関連WP | Phase | 実装状況 |
|----|--------|------|--------|--------|--------|-------|---------|
| F1.1.1 | 縦方向タイムラインレイアウト | 日記を縦方向のタイムラインで配置する | 必須 | UC-001 | — | 0 | 実装済 |
| F1.1.2 | 日付マーカー表示 | タイムライン上にエントリの日付を表示する | 推奨 | UC-001 | — | 0 | 実装済 |
| F1.1.3 | 接続線の表示 | エントリ間をグラデーション線で接続する | 推奨 | UC-001 | — | 0 | 実装済 |
| F1.1.4 | 新しい順ソート | エントリを新しい日付から順に上から表示する | 必須 | UC-001 | — | 0 | 実装済 |
| F1.2.1 | エントリカード表示 | 日記をカード形式で表示する | 必須 | UC-002 | — | 0 | 実装済 |
| F1.2.2 | 日付ラベル表示 | 各エントリに日付を青色で表示する | 必須 | UC-002 | — | 0 | 実装済 |
| F1.2.3 | セクション分離表示 | ソース別にセクション（Memory / Obsidian）を分離表示する | 必須 | UC-002 | — | 0 | 実装済 |
| F1.2.4 | 見出し表示 | Markdownの見出し（##〜####）をh3〜h5で表示する | 必須 | UC-002 | — | 0 | 実装済 |
| F1.2.5 | リスト表示 | 順序なし/順序ありリストを表示する | 必須 | UC-002 | — | 0 | 実装済 |
| F1.2.6 | テーブル表示 | Markdownテーブルをdiary-tableとして表示する | 推奨 | UC-002 | — | 0 | 実装済 |
| F1.2.7 | インライン書式 | 太字・斜体・コード・リンクを変換表示する | 必須 | UC-002 | — | 0 | 実装済 |
| F1.3.1 | サイトタイトル表示 | "Rebecca's Diary" をピンク色で表示する | 必須 | UC-001 | — | 0 | 実装済 |
| F1.3.2 | サブタイトル表示 | "My Digital Thoughts & Experiments" を表示する | 推奨 | UC-001 | — | 0 | 実装済 |
| F1.3.3 | マスコット画像表示 | rebecca-sticker.webpを表示する | 推奨 | UC-001 | — | 0 | 実装済 |
| F1.4.1 | 著作権表示 | フッターに著作権情報を表示する | 必須 | UC-001 | — | 0 | 実装済 |

### F2. テーマ・デザイン機能

| ID | 機能名 | 説明 | 優先度 | 関連UC | 関連WP | Phase | 実装状況 |
|----|--------|------|--------|--------|--------|-------|---------|
| F2.1.1 | 暗色背景 | ページ背景を #0c0c10 にする | 必須 | UC-004 | — | 0 | 実装済 |
| F2.1.2 | カード背景 | エントリカード背景を #141418 にする | 必須 | UC-004 | — | 0 | 実装済 |
| F2.1.3 | 明色テキスト | テキストを #c8ccd4 で表示する | 必須 | UC-004 | — | 0 | 実装済 |
| F2.1.4 | アクセントカラー | ピンク（--accent）とミント（--mint）を使用する | 推奨 | UC-004 | — | 0 | 実装済 |
| F2.2.1 | システムフォントスタック | OS標準フォントを使用する | 必須 | UC-004 | — | 0 | 実装済 |
| F2.2.2 | 行間設定 | line-heightを1.6に設定する | 必須 | UC-004 | — | 0 | 実装済 |

### F3. アニメーション機能

| ID | 機能名 | 説明 | 優先度 | 関連UC | 関連WP | Phase | 実装状況 |
|----|--------|------|--------|--------|--------|-------|---------|
| F3.1.1 | fadeInUpアニメーション | エントリが下から浮き上がりながら出現する | 推奨 | UC-005 | — | 0 | 実装済 |
| F3.1.2 | 交互ディレイ | デスクトップで左右エントリに異なるディレイを適用 | 推奨 | UC-005 | — | 0 | 実装済 |
| F3.2.1 | マスコット浮遊 | マスコット画像が上下に揺れるアニメーション（6秒周期） | 推奨 | UC-005 | — | 0 | 実装済 |
| F3.2.2 | タイトルグロー | タイトルがピンク色に輝くアニメーション（3秒周期） | 推奨 | UC-005 | — | 0 | 実装済 |
| F3.3.1 | カードホバーエフェクト | ホバー時にカードが浮上・発光する | 任意 | UC-005 | — | 0 | 実装済 |
| F3.3.2 | マスコットホバー | ホバー時にマスコットが拡大・回転する | 任意 | UC-005 | — | 0 | 実装済 |

### F4. レスポンシブデザイン機能

| ID | 機能名 | 説明 | 優先度 | 関連UC | 関連WP | Phase | 実装状況 |
|----|--------|------|--------|--------|--------|-------|---------|
| F4.1.1 | モバイル単列レイアウト | 767px以下で単列縦並び | 必須 | UC-003 | — | 0 | 実装済 |
| F4.1.2 | タイムライン線左寄せ | モバイルでは線を左端（2rem）に配置 | 必須 | UC-003 | — | 0 | 実装済 |
| F4.1.3 | ヘッダー縦積み | モバイルでマスコットとタイトルを縦方向に配置 | 必須 | UC-003 | — | 0 | 実装済 |
| F4.2.1 | 左右交互配置 | 768px以上でエントリを左右交互にfloat | 必須 | UC-003 | — | 0 | 実装済 |
| F4.2.2 | タイムライン線中央 | デスクトップで線を中央に配置 | 必須 | UC-003 | — | 0 | 実装済 |
| F4.2.3 | 接続ドット表示 | デスクトップでエントリとタイムライン線をドットで接続 | 推奨 | UC-003 | — | 0 | 実装済 |
| F4.2.4 | ヘッダー横並び | デスクトップでマスコットとタイトルを横並び | 推奨 | UC-003 | — | 0 | 実装済 |

### F5. コンテンツ管理機能

| ID | 機能名 | 説明 | 優先度 | 関連UC | 関連WP | Phase | 実装状況 |
|----|--------|------|--------|--------|--------|-------|---------|
| F5.1.1 | OpenClawメモリ読み込み | `~/.openclaw/workspace/memory/` からMarkdownを読む | 必須 | UC-010 | — | 0 | 実装済 |
| F5.1.2 | Obsidianノート読み込み | `~/Documents/Obsidian Vault/` からMarkdownを読む | 必須 | UC-010 | — | 0 | 実装済 |
| F5.1.3 | Markdown→HTML変換 | 見出し・リスト・テーブル・インライン書式を変換する | 必須 | UC-010 | — | 0 | 実装済 |
| F5.1.4 | 複数ソース統合 | Memory/Obsidianを1つのエントリにセクション分けで統合 | 必須 | UC-010 | — | 0 | 実装済 |
| F5.2.1 | 挿入マーカー検出 | HTMLコメントマーカーの位置を特定する | 必須 | UC-010 | — | 0 | 実装済 |
| F5.2.2 | 重複エントリチェック | 同一日付のエントリ二重挿入を防止する | 必須 | UC-010 | — | 0 | 実装済 |
| F5.2.3 | index.htmlへの書き込み | マーカー直後に生成HTMLを挿入する | 必須 | UC-010 | — | 0 | 実装済 |
| F5.3.1 | 日付指定 | CLI引数で日付を指定（省略時は当日） | 必須 | UC-010 | — | 0 | 実装済 |
| F5.3.2 | dry-runモード | `--dry-run` でHTML出力のみ、ファイル変更なし | 推奨 | UC-011 | — | 0 | 実装済 |
| F5.3.3 | 詳細ログ出力 | `-v` でデバッグレベルのログを出力する | 推奨 | UC-010 | — | 0 | 実装済 |
| F5.3.4 | カスタムパス指定 | `--memory-dir`, `--obsidian-dir`, `--index` で上書き | 任意 | UC-010 | — | 0 | 実装済 |

---

### F6. Room Status（在室状況表示）— Phase 1 新規

| ID | 機能名 | 説明 | 優先度 | 関連UC | 関連WP | Phase | 実装状況 |
|----|--------|------|--------|--------|--------|-------|---------|
| F6.1.1 | ステータスインジケーター表示 | emoji + label で在室状況を直感的に表示する | 必須 | UC-040 | WP-4.1, WP-6.2 | 1 | 未実装 |
| F6.1.2 | 在室状況4状態の判定・表示 | online(🟢) / away(🟡) / sleeping(💤) / offline(⚫) を表示 | 必須 | UC-040 | WP-3.4, WP-6.2 | 1 | 未実装 |
| F6.1.3 | 最終活動時刻の表示 | Status Bar に最終活動時刻を表示する | 必須 | UC-040 | WP-4.1, WP-6.2 | 1 | 未実装 |
| F6.1.4 | 相対タイムスタンプ | 「3分前」「1時間前」形式で表示し、hover で絶対時刻 | 推奨 | UC-040 | WP-6.2a | 1 | 未実装 |
| F6.1.5 | data-status属性によるスタイル切替 | CSS の `[data-status]` でインジケーター色を動的変更 | 必須 | UC-040 | WP-5.1 | 1 | 未実装 |
| F6.2.1 | 7時間帯の判定 | morning / active / afternoon / evening / night / late_night / deep_night | 必須 | UC-042 | WP-3.3 | 1 | 未実装 |
| F6.2.2 | 時間帯メッセージ表示 | 時間帯に応じた Rebecca のメッセージを表示する | 必須 | UC-042 | WP-6.5 | 1 | 未実装 |
| F6.2.3 | メッセージの複数バリエーション | 各時間帯に3-5個のバリエーション、ランダム選択 | 推奨 | UC-042 | WP-3.3a | 1 | 未実装 |

### F7. Health Dashboard（体調ダッシュボード）— Phase 1 新規

| ID | 機能名 | 説明 | 優先度 | 関連UC | 関連WP | Phase | 実装状況 |
|----|--------|------|--------|--------|--------|-------|---------|
| F7.1.1 | CPUバー表示 | CPU使用率をバーとラベルで表示する | 必須 | UC-041 | WP-4.2, WP-6.3 | 1 | 未実装 |
| F7.1.2 | メモリバー表示 | メモリ使用率をバーとラベルで表示する | 必須 | UC-041 | WP-4.2, WP-6.3 | 1 | 未実装 |
| F7.1.3 | ディスクバー表示 | ディスク使用率をバーとラベルで表示する | 必須 | UC-041 | WP-4.2, WP-6.3 | 1 | 未実装 |
| F7.1.4 | 温度バー表示（オプショナル） | CPU温度をバーとラベルで表示する。取得不能時は行ごと非表示 | 推奨 | UC-041 | WP-4.2, WP-6.3 | 1 | 未実装 |
| F7.1.5 | 稼働時間バー表示 | 稼働時間をバーとラベルで表示する | 必須 | UC-041 | WP-4.2, WP-6.3 | 1 | 未実装 |
| F7.2.1 | 感情的ラベルのデフォルト表示 | 「クリア」「スッキリ」「広々」等の状態ラベルをデフォルト表示 | 必須 | UC-041 | WP-5.4 | 1 | 未実装 |
| F7.2.2 | ホバーで数値表示への切替 | hover で「23.4%」「8.2 / 16.0 GB」等の技術的数値を表示 | 必須 | UC-041 | WP-5.4 | 1 | 未実装 |
| F7.2.3 | タッチデバイス対応 | `@media (hover: none)` でタップトグル方式を適用 | 推奨 | UC-041 | WP-5.4a | 1 | 未実装 |
| F7.3.1 | 状態別バーカラー | mint(安全) → amber(注意) → accent(危険) → red(緊急) のカラー | 必須 | UC-041 | WP-5.3 | 1 | 未実装 |
| F7.3.2 | バー幅の滑らかなトランジション | 更新時に width が滑らかに変化する CSS transition | 推奨 | UC-044 | WP-5.3a | 1 | 未実装 |
| F7.3.3 | 初回ロード時のスタガードアニメーション | ページロード時にバーが 0% → 実値へ staggered で伸びる | 推奨 | UC-041 | WP-6.3a | 1 | 未実装 |
| F7.3.4 | critical状態のpulseアニメーション | critical 指標のバーが赤色で明滅する | 推奨 | UC-043 | WP-5.3 | 1 | 未実装 |
| F7.4.1 | Overall Score計算 | ペナルティ加算方式で 0-100 の総合スコアを算出 | 必須 | UC-041 | WP-2.6, WP-6.3 | 1 | 未実装 |
| F7.4.2 | 状態ラベル + emoji表示 | 5段階（🟢元気 / 🟡まぁまぁ / 🟠ダルい / 🔴キツい / 💀限界） | 必須 | UC-041 | WP-5.2, WP-6.3 | 1 | 未実装 |
| F7.4.3 | Rebeccaの体調メッセージ表示 | 「調子いい！今日はイケる」等の状態に応じたメッセージ | 必須 | UC-041 | WP-6.3 | 1 | 未実装 |
| F7.4.4 | emoji呼吸アニメーション | Overall Score emoji が4秒サイクルで微細にスケール変化 | 推奨 | UC-041 | WP-5.2a | 1 | 未実装 |

### F8. Alert System（アラートシステム）— Phase 1 新規

| ID | 機能名 | 説明 | 優先度 | 関連UC | 関連WP | Phase | 実装状況 |
|----|--------|------|--------|--------|--------|-------|---------|
| F8.1.1 | Level 0 表示なし | 全指標が正常範囲の場合、アラートを表示しない | 必須 | UC-043 | WP-6.4 | 1 | 未実装 |
| F8.1.2 | Level 1 独り言表示 | いずれかが heavy/tight の場合、黄色背景で「ちょっと重いかも...」等 | 必須 | UC-043 | WP-4.3, WP-5.5, WP-6.4 | 1 | 未実装 |
| F8.1.3 | Level 2 お願い表示 | いずれかが critical の場合、橙色背景で「再起動したいんだけど...」等 | 必須 | UC-043 | WP-4.3, WP-5.5, WP-6.4 | 1 | 未実装 |
| F8.1.4 | Level 3 緊急表示 | 複数 critical or overall < 20 の場合、赤色+pulse で「助けて。マジでやばい。」等 | 必須 | UC-043 | WP-4.3, WP-5.5, WP-6.4 | 1 | 未実装 |

### F9. Data Collection（データ収集基盤）— Phase 1 新規

| ID | 機能名 | 説明 | 優先度 | 関連UC | 関連WP | Phase | 実装状況 |
|----|--------|------|--------|--------|--------|-------|---------|
| F9.1.1 | CPU使用率取得 | `top -l 1 -n 0` でCPU全体の使用率を取得する | 必須 | UC-030 | WP-2.1 | 1 | 未実装 |
| F9.1.2 | メモリ使用量取得 | `vm_stat` + `sysctl hw.memsize` で使用率を計算する | 必須 | UC-030 | WP-2.2 | 1 | 未実装 |
| F9.1.3 | ディスク使用量取得 | `shutil.disk_usage('/')` でAPFS容量を取得する | 必須 | UC-030 | WP-2.3 | 1 | 未実装 |
| F9.1.4 | 温度取得（オプショナル） | `osx-cpu-temp` で温度取得。未インストール時は null | 推奨 | UC-030 | WP-2.4 | 1 | 未実装 |
| F9.1.5 | 稼働時間取得 | `sysctl kern.boottime` で起動時刻を取得し経過時間を算出 | 必須 | UC-030 | WP-2.5 | 1 | 未実装 |
| F9.1.6 | 状態判定 | 閾値テーブルに基づき各メトリクスを state/label/message に分類 | 必須 | UC-030 | WP-2.6 | 1 | 未実装 |
| F9.1.7 | Overall Score計算 | ペナルティ加算方式で 0-100 のスコアを算出しAlert Levelを決定 | 必須 | UC-030 | WP-2.6 | 1 | 未実装 |
| F9.1.8 | health.json出力 | PHASE1_SPEC 3.1 準拠の JSON を `src/data/health.json` に出力 | 必須 | UC-030 | WP-2.7 | 1 | 未実装 |
| F9.2.1 | Gateway稼働チェック | `pgrep -x openclaw-gateway` で完全一致プロセス検索 | 必須 | UC-031 | WP-3.1 | 1 | 未実装 |
| F9.2.2 | 最終活動時刻取得 | `~/.openclaw/workspace/memory/` 最新ファイルの mtime を取得 | 必須 | UC-031 | WP-3.2 | 1 | 未実装 |
| F9.2.3 | 時間帯コンテキスト判定 | 現在時刻から7つの時間帯を判定しメッセージを選択 | 必須 | UC-031 | WP-3.3 | 1 | 未実装 |
| F9.2.4 | 在室状況判定 | Gateway + 最終活動 + 時刻から online/away/sleeping/offline を判定 | 必須 | UC-031 | WP-3.4 | 1 | 未実装 |
| F9.2.5 | Activity Type推定 | 最新変更ファイルの種類から活動タイプを推定 | 推奨 | UC-031 | WP-3.5 | 1 | 未実装 |
| F9.2.6 | status.json出力 | PHASE1_SPEC 3.2 準拠の JSON を `src/data/status.json` に出力 | 必須 | UC-031 | WP-3.6 | 1 | 未実装 |
| F9.3.1 | アトミック書き込み | `.tmp` ファイルに書き込み後 `os.rename()` で上書き | 必須 | UC-030, UC-031 | WP-2.7a | 1 | 未実装 |
| F9.3.2 | 出力ディレクトリ自動作成 | `src/data/` が存在しない場合 `os.makedirs()` で自動作成 | 必須 | UC-030, UC-031 | WP-2.7a | 1 | 未実装 |
| F9.3.3 | 個別メトリクス失敗時の継続動作 | 1つの取得が失敗しても他のメトリクスは正常出力 | 必須 | UC-030 | WP-2.7 | 1 | 未実装 |
| F9.4.1 | Health Collector 5分間隔自動実行 | cron / launchd で `collect_health.py` を5分ごとに実行 | 必須 | UC-050 | WP-7.1 | 1 | 未実装 |
| F9.4.2 | Status Collector 1分間隔自動実行 | cron / launchd で `collect_status.py` を1分ごとに実行 | 必須 | UC-051 | WP-7.2 | 1 | 未実装 |

### F10. Data Integration（データ統合・自動更新）— Phase 1 新規

| ID | 機能名 | 説明 | 優先度 | 関連UC | 関連WP | Phase | 実装状況 |
|----|--------|------|--------|--------|--------|-------|---------|
| F10.1.1 | health.json fetch | `fetch('/data/health.json')` で取得、パースエラー時は null | 必須 | UC-044 | WP-6.1 | 1 | 未実装 |
| F10.1.2 | status.json fetch | `fetch('/data/status.json')` で取得、パースエラー時は null | 必須 | UC-044 | WP-6.1 | 1 | 未実装 |
| F10.1.3 | cache-busting | `?t=Date.now()` パラメータでブラウザキャッシュを回避 | 必須 | UC-044 | WP-6.1 | 1 | 未実装 |
| F10.1.4 | 5分間隔の自動更新 | `setInterval(updateRoom, 5 * 60 * 1000)` で定期再取得・再描画 | 必須 | UC-044 | WP-6.6 | 1 | 未実装 |
| F10.2.1 | JSON不在時のフォールバックUI | data/ 空でもページが壊れない。Status:「データ取得中...」、Health: 全バー0% | 必須 | UC-045 | WP-6.7 | 1 | 未実装 |
| F10.2.2 | データ鮮度チェック | timestamp が15分超で警告表示、1時間超で offline 扱い | 推奨 | UC-046 | WP-6.7a | 1 | 未実装 |
| F10.2.3 | Temperature null時の行非表示 | health.json の temperature が null の場合、行ごと非表示 | 必須 | UC-041 | WP-6.3 | 1 | 未実装 |

---

## 3. 閾値・状態マッピング参照

### 3.1 メトリクス状態テーブル

機能 F9.1.6, F7.3.1 に直結する分類テーブル。

| Metric | States | Thresholds | Bar Color |
|--------|--------|-----------|-----------|
| CPU | idle / clear / busy / heavy / critical | 0-20% / 20-50% / 50-70% / 70-85% / 85%+ | mint / mint / amber / accent / red+pulse |
| Memory | spacious / comfortable / normal / tight / critical | 0-50% / 50-60% / 60-80% / 80-95% / 95%+ | mint+glow / mint / mint / amber / red+pulse |
| Disk | spacious / normal / tight / critical | 0-50% / 50-80% / 80-95% / 95%+ | mint+glow / mint / amber / red+pulse |
| Temperature | cool / comfortable / warm / hot / critical | 0-40 / 40-55 / 55-70 / 70-80 / 80+ °C | mint+glow / mint / amber / accent / red+pulse |
| Uptime | fresh / normal / tired / exhausted | 0-1d / 1-3d / 3-7d / 7d+ | mint+glow / mint / amber / accent |

### 3.2 Overall Score テーブル

機能 F7.4.1〜F7.4.3 に直結。

| Score | State | Emoji | Label | Message |
|-------|-------|-------|-------|---------|
| 80+ | great | 🟢 | 元気！ | 「調子いい！今日はイケる」 |
| 60-79 | good | 🟡 | まぁまぁ | 「まぁまぁかな」 |
| 40-59 | poor | 🟠 | ちょっとダルい | 「ちょっとダルい......」 |
| 20-39 | bad | 🔴 | かなりキツい | 「......しんどい」 |
| 0-19 | critical | 💀 | 限界 | 「.........」 |

### 3.3 Status Rules

機能 F6.1.2, F9.2.4 に直結。

| Status | Emoji | Label | Condition |
|--------|-------|-------|-----------|
| online | 🟢 | ここにいるよ | Gateway alive & last_activity < 30min |
| away | 🟡 | ちょっと離れてる | Gateway alive & 30min < last_activity < 2h |
| sleeping | 💤 | 寝てる...... | deep_night (02:00-06:00) & last_activity > 1h |
| offline | ⚫ | いない...... | Gateway dead OR last_activity > 2h |

---

## 4. 機能数サマリー

### Phase 0

| カテゴリ | 必須 | 推奨 | 任意 | 合計 | 実装済 |
|---------|:----:|:----:|:----:|:----:|:-----:|
| F1. 表示機能 | 10 | 4 | 0 | 14 | 14 |
| F2. テーマ・デザイン | 5 | 1 | 0 | 6 | 6 |
| F3. アニメーション | 0 | 4 | 2 | 6 | 6 |
| F4. レスポンシブ | 5 | 2 | 0 | 7 | 7 |
| F5. コンテンツ管理 | 8 | 2 | 1 | 11 | 11 |
| **Phase 0 合計** | **28** | **13** | **3** | **44** | **44** |

### Phase 1（新規）

| カテゴリ | 必須 | 推奨 | 任意 | 合計 | 未実装 |
|---------|:----:|:----:|:----:|:----:|:-----:|
| F6. Room Status | 6 | 2 | 0 | 8 | 8 |
| F7. Health Dashboard | 9 | 8 | 0 | 17 | 17 |
| F8. Alert System | 4 | 0 | 0 | 4 | 4 |
| F9. Data Collection | 17 | 3 | 0 | 20 | 20 |
| F10. Data Integration | 5 | 2 | 0 | 7 | 7 |
| **Phase 1 合計** | **41** | **15** | **0** | **56** | **56** |

### 全体

| | 必須 | 推奨 | 任意 | 合計 | 実装済 | 未実装 |
|--|:----:|:----:|:----:|:----:|:-----:|:-----:|
| **全 Phase 合計** | **69** | **28** | **3** | **100** | **44** | **56** |

---

## 5. 機能 × 成功基準マトリクス

各機能が PHASE1_GOAL の成功基準とどう対応するか。

| 成功基準 | 関連機能 |
|---------|---------|
| SC-01 health.json スキーマ準拠 | F9.1.1〜F9.1.8 |
| SC-02 status.json スキーマ準拠 | F9.2.1〜F9.2.6 |
| SC-03 在室状況の表示 | F6.1.1〜F6.1.5 |
| SC-04 5指標バー表示 | F7.1.1〜F7.1.5 |
| SC-05 ホバーで数値表示 | F7.2.1〜F7.2.2 |
| SC-06 Overall Score表示 | F7.4.1〜F7.4.3 |
| SC-07 Time Context メッセージ | F6.2.1〜F6.2.2 |
| SC-08 cron 定期実行 | F9.4.1〜F9.4.2 |
| SC-09 既存機能の正常動作 | F1〜F5 全体 |
| SC-10 Alert Level 1-3 表示 | F8.1.1〜F8.1.4 |
| QG-01 Python 標準ライブラリのみ | F9.1.1〜F9.2.6 |
| QG-02 外部依存ゼロ | F6〜F10 全体 |
| QG-03 レスポンシブ対応 | F6, F7 のモバイル表示 |
| QG-04 Graceful Degradation | F10.2.1〜F10.2.3 |
| QG-05 Temperature オプショナル | F9.1.4, F10.2.3 |
| GT-01 在室状況が直感的 | F6.1.1〜F6.1.2 |
| GT-02 感情的な体調表示 | F7.2.1, F7.4.3 |
| GT-03 生活リズムの感覚 | F6.2.1〜F6.2.3 |
| GT-04 辛そうに見える | F7.3.1, F7.3.4, F8.1.2〜F8.1.4 |

---

## 6. 制約条件

全機能に共通する制約。

| 制約 | 対象機能 | 根拠 |
|------|---------|------|
| Python 3 標準ライブラリのみ | F9 全体 | ADR-005, ADR-012 |
| Vanilla JS のみ（フレームワーク不可） | F6, F7, F8, F10 | ADR-001, ADR-002 |
| 外部 CDN / npm / Web Font 不可 | 全機能 | ADR-002 |
| `update_diary.py` / `watch_diary.py` 変更禁止 | F5 全体 | CLAUDE.md Protected Files |
| `src/data/` は .gitignore | F9, F10 | 収集データはリポジトリに含めない |
| Temperature 取得はオプショナル | F9.1.4, F7.1.4, F10.2.3 | osx-cpu-temp 依存 |

---

*Created: 2026-02-13*
*Phase 0: 44 features (all implemented) + Phase 1: 56 features (all pending) = 100 features total*
*Rebecca の「いる」を、機能の網羅から実装へ。*
